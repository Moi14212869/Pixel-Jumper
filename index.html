<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pixel Jumper</title>
        <style>
			body {
				margin: 0;
				background-color: #3d2505;
			}
			canvas {
				display: block;
				margin: 75px auto;
			}
		</style>
        <script src="phaser.min.js"></script>
		<script src="https://poki.com/sdk/poki.js"></script>
    </head>
    <body>


        <script>
		/* =========================================================
                    FONCTIONS COMMUNES
========================================================= */
let playerCoins = parseInt(localStorage.getItem("playerCoins")) || 0;
let pokiReady = false;
let colorPlayer = parseInt(localStorage.getItem("colorPlayer")) || 0xAA66CC;
window.PokiSDK && PokiSDK.init && PokiSDK.init().then(() => {
    pokiReady = true;
});
function showInterstitial() {
    if (pokiReady && PokiSDK.ads.isAdReady()) {
        PokiSDK.ads.showAd();
    }
}


function createPlatform(scene, x, y, widthInPx, heightInPx = 40, color = 0xA0522D) {
    const tileSize = 40;
    const blocksPerRow = Math.floor(widthInPx / tileSize);
    const blocksPerCol = Math.floor(heightInPx / tileSize);

    for (let row = 0; row < blocksPerCol; row++) {
        for (let col = 0; col < blocksPerRow; col++) {
            const gfx = scene.add.graphics();
            gfx.fillStyle(color, 1);
            gfx.fillRect(0, 0, tileSize, tileSize);

            const key = `block-${x + col * tileSize}-${y + row * tileSize}`;
            gfx.generateTexture(key, tileSize, tileSize);
            gfx.destroy();

            const block = scene.platforms.create(x + col * tileSize, y + row * tileSize, key);
            block.setOrigin(0, 0);
            block.refreshBody();
        }
    }
}

function createBlueCircle(scene, x, y) {
    const radius = 20;
    const gfx = scene.add.graphics();
    gfx.fillStyle(0x0000FF, 1);
    gfx.fillCircle(radius, radius, radius);

    const key = `blueCircle-${x}-${y}`;
    gfx.generateTexture(key, radius * 2, radius * 2);
    gfx.destroy();

    const circle = scene.physics.add.sprite(x, y, key);
    circle.setCircle(radius);
    circle.setOrigin(0.5);
    circle.body.allowGravity = false;

    scene.tweens.add({
        targets: circle,
        y: circle.y - 5,
        duration: 800,
        yoyo: true,
        repeat: -1,
        ease: "Sine.easeInOut"
    });

    return circle;
}

function createRedTriangle(scene, x, y, orientation = 'up') {
    const size = 40;
    const height = Math.sqrt(3) / 2 * size;
    const key = `triangle-${x}-${y}-${orientation}`;

    const gfx = scene.add.graphics();
    gfx.fillStyle(0xFF0000, 1);
    gfx.beginPath();

    if (orientation === 'up') { gfx.moveTo(size / 2, 0); gfx.lineTo(0, height); gfx.lineTo(size, height); }
    else if (orientation === 'down') { gfx.moveTo(size / 2, height); gfx.lineTo(0, 0); gfx.lineTo(size, 0); }
    else if (orientation === 'left') { gfx.moveTo(0, size / 2); gfx.lineTo(height, 0); gfx.lineTo(height, size); }
    else if (orientation === 'right') { gfx.moveTo(height, size / 2); gfx.lineTo(0, 0); gfx.lineTo(0, size); }

    gfx.closePath();
    gfx.fillPath();

    if (orientation === 'left' || orientation === 'right') gfx.generateTexture(key, height, size);
    else gfx.generateTexture(key, size, height);
    gfx.destroy();

    const triangle = scene.spikes.create(x, y, key);

    switch (orientation) {
        case 'up': triangle.setOrigin(0.5, 1); break;
        case 'down': triangle.setOrigin(0.5, 0); break;
        case 'left': triangle.setOrigin(1, 0.5); break;
        case 'right': triangle.setOrigin(0, 0.5); break;
    }

    triangle.refreshBody();

    const body = triangle.body;
    const bodyWidth = body.width * 0.7;
    const bodyHeight = body.height * 0.7;
    const offsetX = (body.width - bodyWidth) / 2;
    const offsetY = (body.height - bodyHeight) / 2;

    body.setSize(bodyWidth, bodyHeight);
    body.setOffset(offsetX, offsetY);

    return triangle;
}


/* =========================================================
                        MENU SCENE
========================================================= */

class MenuScene extends Phaser.Scene {
    constructor() {
        super("MenuScene");
    }

    create() {
		
        const title = this.add.text(400, 120, "Pixel Jumper", {
            fontSize: "50px",
            color: "#ffffffff"
        }).setOrigin(0.5);
		this.coinText = this.add.text(780, 20, `üí∞ ${playerCoins}`, {
    		fontSize: "28px",
    		color: "#ffff00"
		}).setOrigin(1, 0); // align√© √† droite
        const niveaux = [
            { nom: "Shop üõí", scene: "ShopScene" },
            { nom: "‚û° Play !!", scene: "World1" },
        ];

        let yPos = 260;
        niveaux.forEach(niv => {
            const btn = this.add.text(400, yPos, niv.nom, {
                fontSize: "34px",
                color: "#ffffffff"
            }).setOrigin(0.5).setInteractive();

            btn.on("pointerdown", () => this.scene.start(niv.scene));

            yPos += 60; // √©cart vertical entre boutons
        });
    }
}


/* =========================================================
                        LEVEL 1
========================================================= */

class Level1 extends Phaser.Scene {
    constructor() {
        super("Level1");
    }

    create() {
		this.transitioning = false;
        this.platforms = this.physics.add.staticGroup();
        this.spikes = this.physics.add.staticGroup();
		
				//bouton
		const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("World1");
        });
		
        // plateformes
        createPlatform(this, 0, 560, 800);
        createPlatform(this, 400, 400, 120);
        createPlatform(this, 600, 300, 80);
        createPlatform(this, 200, 250, 160);
        createPlatform(this, 0, 150, 120);

        // joueur
        const size = 40;
        const g = this.add.graphics();
        g.fillStyle(colorPlayer, 1);
        g.fillRect(0, 0, size, size);
        g.generateTexture("player", size, size);
        g.destroy();

        this.player = this.physics.add.sprite(100, 450, "player");
        this.player.setBounce(0.2).setCollideWorldBounds(true);

        // objets
        this.blueCircle = createBlueCircle(this, 40, 120);

        createRedTriangle(this, 380, 560);
        createRedTriangle(this, 420, 560);
        createRedTriangle(this, 280, 250);

        // collisions
        this.physics.add.collider(this.player, this.platforms);
        this.physics.add.collider(this.player, this.spikes, () => this.scene.restart());

        // sortie vers niveau 2
  this.physics.add.overlap(this.player, this.blueCircle, () => {
    if (this.transitioning) return;
    this.transitioning = true;

    this.player.body.enable = false;

    const targetX = this.blueCircle.x;
    const targetY = this.blueCircle.y;

    this.tweens.add({
      targets: this.player,
      x: targetX,
      y: targetY,
      scale: 0.3,
      angle: 720,
      duration: 800,
      ease: 'Cubic.easeInOut',
      onComplete: () => {
		  showInterstitial();
		  playerCoins += 10;
		  localStorage.setItem("playerCoins", playerCoins)
		  this.scene.start("World1");
	  }

    });
  }, null, this);
 // --- BOUTONS DANS LE CANVAS ---
    const btnStyle = { fontSize: "32px", color: "#ffffff", backgroundColor: "#00BFFF", padding: {x:10, y:5}, borderRadius: 5 };
    this.leftBtn = this.add.text(50, 520, "‚óÄ", btnStyle).setInteractive();
    this.rightBtn = this.add.text(150, 520, "‚ñ∂", btnStyle).setInteractive();
    this.jumpBtn = this.add.text(700, 520, "‚¨Ü", btnStyle).setInteractive();

    // Variables pour savoir si le bouton est press√©
    this.movingLeft = false;
    this.movingRight = false;

    // √âv√©nements tactiles
    this.leftBtn.on('pointerdown', () => this.movingLeft = true);
    this.leftBtn.on('pointerup', () => this.movingLeft = false);
    this.rightBtn.on('pointerdown', () => this.movingRight = true);
    this.rightBtn.on('pointerup', () => this.movingRight = false);
    this.jumpBtn.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }

update() {
    const p = this.player;

    // D√©placement horizontal
    if (this.cursors.left.isDown || this.movingLeft) p.setVelocityX(-160);
    else if (this.cursors.right.isDown || this.movingRight) p.setVelocityX(160);
    else p.setVelocityX(0);

    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}

}

/* =========================================================
                        LEVEL 2
========================================================= */

class Level2 extends Phaser.Scene {
    constructor() {
        super("Level2");
    }

    create() {
		this.transitioning = false;
        this.platforms = this.physics.add.staticGroup();
        this.spikes = this.physics.add.staticGroup();
		
        createPlatform(this, 0, 560, 800);
        createPlatform(this, 200, 480, 600, 80);
        createPlatform(this, 0, 280, 480, 80);
        createPlatform(this, 0, 360, 80);
        createPlatform(this, 0, 400, 40);
        createPlatform(this, 440, 360, 80);
        createPlatform(this, 480, 400, 80);
        createPlatform(this, 640, 80, 40, 400);
        createPlatform(this, 0, 200, 200, 80);
        createPlatform(this, 80, 80, 480, 40);
        createPlatform(this, 360, 240, 40);
        createPlatform(this, 280, 200, 80, 80);
        createPlatform(this, 200, 240, 80, 40);
        createPlatform(this, 0, 0, 40);
        createPlatform(this, 0, 160, 40);
        createPlatform(this, 680, 440, 40);
        createPlatform(this, 760, 440, 40);
		//bouton
		const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("World1");
        });
        // joueur
        const size = 40;
        const g = this.add.graphics();
        g.fillStyle(colorPlayer, 1);
        g.fillRect(0, 0, size, size);
        g.generateTexture("player", size, size);
        g.destroy();

        this.player = this.physics.add.sprite(100, 450, "player");
        this.player.setBounce(0.2).setCollideWorldBounds(true);

        // piques
        createRedTriangle(this, 180, 560);
        createRedTriangle(this, 140, 560);
        createRedTriangle(this, 300, 480);
        createRedTriangle(this, 340, 480);
        createRedTriangle(this, 20, 560);
        createRedTriangle(this, 500, 360);
        createRedTriangle(this, 420, 280);
        createRedTriangle(this, 380, 240);
        createRedTriangle(this, 260, 240);
        createRedTriangle(this, 220, 240);
        createRedTriangle(this, 780, 440);
        createRedTriangle(this, 700, 440);

        // sortie ‚Üí retour menu
        this.blueCircle = createBlueCircle(this, 740, 420);

        this.physics.add.collider(this.player, this.platforms);
        this.physics.add.collider(this.player, this.spikes, () => this.scene.restart());
   this.physics.add.overlap(this.player, this.blueCircle, () => {
    if (this.transitioning) return;
    this.transitioning = true;

    this.player.body.enable = false;

    const targetX = this.blueCircle.x;
    const targetY = this.blueCircle.y;

    this.tweens.add({
      targets: this.player,
      x: targetX,
      y: targetY,
      scale: 0.3,
      angle: 720,
      duration: 800,
      ease: 'Cubic.easeInOut',
      onComplete: () => {
		showInterstitial()
		playerCoins += 10;
		localStorage.setItem("playerCoins", playerCoins)
        this.scene.start("World1");
      }
    });
  }, null, this);
 // --- BOUTONS DANS LE CANVAS ---
    const btnStyle = { fontSize: "32px", color: "#ffffff", backgroundColor: "#00BFFF", padding: {x:10, y:5}, borderRadius: 5 };
    this.leftBtn = this.add.text(50, 520, "‚óÄ", btnStyle).setInteractive();
    this.rightBtn = this.add.text(150, 520, "‚ñ∂", btnStyle).setInteractive();
    this.jumpBtn = this.add.text(700, 520, "‚¨Ü", btnStyle).setInteractive();

    // Variables pour savoir si le bouton est press√©
    this.movingLeft = false;
    this.movingRight = false;

    // √âv√©nements tactiles
    this.leftBtn.on('pointerdown', () => this.movingLeft = true);
    this.leftBtn.on('pointerup', () => this.movingLeft = false);
    this.rightBtn.on('pointerdown', () => this.movingRight = true);
    this.rightBtn.on('pointerup', () => this.movingRight = false);
    this.jumpBtn.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }


update() {
    const p = this.player;

    // D√©placement horizontal
    if (this.cursors.left.isDown || this.movingLeft) p.setVelocityX(-160);
    else if (this.cursors.right.isDown || this.movingRight) p.setVelocityX(160);
    else p.setVelocityX(0);

    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}

}
window.onerror = function (message, source, lineno, colno, error) {
  alert("Erreur JS : " + message + "\n" + source + ":" + lineno);
};

/* =========================================================
                    FONCTIONS COMMUNES
========================================================= */
function createRedCircle(scene, x, y, riseAmount = 100, direction = 'up') {
  const radius = 10;

  const gfx = scene.add.graphics();
  gfx.fillStyle(0xFF0000, 1);
  gfx.fillCircle(radius, radius, radius);
  const key = `redCircle-${x}-${y}`;
  gfx.generateTexture(key, radius * 2, radius * 2);
  gfx.destroy();

  const circle = scene.physics.add.sprite(x, y, key);
  circle.setCircle(radius);
  circle.setOrigin(0.5);
  circle.body.moves = false;
  circle.body.allowGravity = false;
  circle.body.immovable = true;

  const targetY = direction === 'up' ? y - riseAmount : y + riseAmount;

  scene.tweens.add({
    targets: circle,
    y: targetY,
    duration: 2000,
    yoyo: true,
    repeat: -1,
    ease: 'Sine.easeInOut'
  });

  return circle;
}
function onPlayerHitSpike(player, spike, scene) {
  scene.scene.restart();
}
function createRedSquare(x, y, scene, distance = 100, direction = 'right') {
  const size = 40;

  // Dessin du carr√© rouge
  const gfx = scene.add.graphics();
  gfx.fillStyle(0xFF0000, 1);
  gfx.fillRect(0, 0, size, size);

  const key = `redSquare-${x}-${y}-${direction}`;
  gfx.generateTexture(key, size, size);
  gfx.destroy();

  const square = scene.physics.add.sprite(x, y, key);
  square.setSize(size, size);
  square.setOrigin(0.5);
  square.body.allowGravity = false;
  square.body.immovable = true;

  // Animation horizontale
  let targetX = x;

  if (direction === 'right') {
    targetX = x + distance;
  } else if (direction === 'left') {
    targetX = x - distance;
  } else {
    console.warn('Direction inconnue pour redSquare :', direction);
  }

  scene.tweens.add({
    targets: square,
    x: targetX,
    duration: 2000,
    yoyo: true,
    repeat: -1,
    ease: 'Sine.easeInOut'
  });

  return square;
}
/* =========================================================
                        LEVEL 3
========================================================= */
class Level3 extends Phaser.Scene {
  constructor() { super("Level3"); }

  create() {
	this.transitioning = false;
    this.platforms = this.physics.add.staticGroup();
    this.spikes = this.physics.add.staticGroup();
    this.redCircles = this.physics.add.group();

    // Plateformes Level 3
    createPlatform(this, 0, 560, 800);
    createPlatform(this, 0, 360, 720, 80);
    createPlatform(this, 0, 520, 80, 40);
    createPlatform(this, 0, 440, 40, 40);
    createPlatform(this, 0, 480, 40, 40);
    createPlatform(this, 720, 520, 80, 40);
    createPlatform(this, 760, 400, 40, 120);
    createPlatform(this, 760, 200, 40, 80);
    createPlatform(this, 80, 200, 520, 40);
    createPlatform(this, 680, 200, 80, 40);
    createPlatform(this, 0, 320, 80, 40);
    createPlatform(this, 0, 80, 40, 40);
    createPlatform(this, 0, 0, 80, 80);
    createPlatform(this, 120, 160, 120, 40);
    createPlatform(this, 160, 120, 440, 40);
    createPlatform(this, 680, 120, 120, 80);
    createPlatform(this, 80, 0, 720, 40);
    createPlatform(this, 520, 160, 80, 40);
    createPlatform(this, 240, 160, 280, 40, 0xCC99E6);
		//bouton
		const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("World1");
        });
    // Joueur
    const playerSize = 40;
    const playerGfx = this.add.graphics();
    playerGfx.fillStyle(colorPlayer, 1);
    playerGfx.fillRect(0, 0, playerSize, playerSize);
    playerGfx.generateTexture('playerSquare', playerSize, playerSize);
    playerGfx.destroy();

    this.player = this.physics.add.sprite(100, 450, 'playerSquare');
    this.player.setBounce(0.2);
    this.player.setCollideWorldBounds(true);

    // Piques Level 3
  createRedTriangle(this, 60, 520);
  createRedTriangle(this, 420, 560);
  createRedTriangle(this, 460, 560);
  createRedTriangle(this, 500, 560);
  createRedTriangle(this, 60, 440, "down");
  createRedTriangle(this, 620, 560);
  createRedTriangle(this, 780, 280, "down");
  createRedTriangle(this, 740, 240, "down");
  createRedTriangle(this, 660, 360);
  createRedTriangle(this, 620, 360);
  createRedTriangle(this, 100, 360);
  createRedTriangle(this, 140, 360);
  createRedTriangle(this, 0, 300, "right");
  createRedTriangle(this, 0, 260, "right");
  createRedTriangle(this, 0, 220, "right");
  createRedTriangle(this, 0, 180, "right");
  createRedTriangle(this, 0, 140, "right");
  createRedTriangle(this, 60, 80, "down");
  createRedTriangle(this, 100, 40, "down");
  createRedTriangle(this, 140, 40, "down");
  createRedTriangle(this, 180, 40, "down");
  createRedTriangle(this, 800, 60, "left");
  createRedTriangle(this, 800, 100, "left");

    // Boules rouges Level 3
    this.redCircles.add(createRedCircle(this, 200, 550));
    this.redCircles.add(createRedCircle(this, 240, 550));
    this.redCircles.add(createRedCircle(this, 280, 550));
    this.redCircles.add(createRedCircle(this, 480, 350));
    this.redCircles.add(createRedCircle(this, 400, 250, 100, 'down'));
    this.redCircles.add(createRedCircle(this, 320, 350));
    this.redCircles.add(createRedCircle(this, 480, 110, 60));
    this.redCircles.add(createRedCircle(this, 400, 50, 60, 'down'));
    this.redCircles.add(createRedCircle(this, 320, 110, 60));

    // Boule bleue
    this.blueCircle = createBlueCircle(this, 740, 80);

    // Collisions
    this.physics.add.collider(this.player, this.platforms);
    this.physics.add.collider(this.player, this.spikes, (p, s) => onPlayerHitSpike(p, s, this));
    this.physics.add.overlap(this.player, this.redCircles, () => this.scene.restart());
  this.physics.add.overlap(this.player, this.blueCircle, () => {
    if (this.transitioning) return;
    this.transitioning = true;

    this.player.body.enable = false;

    const targetX = this.blueCircle.x;
    const targetY = this.blueCircle.y;

    this.tweens.add({
      targets: this.player,
      x: targetX,
      y: targetY,
      scale: 0.3,
      angle: 720,
      duration: 800,
      ease: 'Cubic.easeInOut',
      onComplete: () => {
		showInterstitial()
		playerCoins += 10;
		localStorage.setItem("playerCoins", playerCoins)
        this.scene.start("World1");
      }
    });
  }, null, this);
	   // --- BOUTONS DANS LE CANVAS ---
    const btnStyle = { fontSize: "32px", color: "#ffffff", backgroundColor: "#00BFFF", padding: {x:10, y:5}, borderRadius: 5 };
    this.leftBtn = this.add.text(50, 520, "‚óÄ", btnStyle).setInteractive();
    this.rightBtn = this.add.text(150, 520, "‚ñ∂", btnStyle).setInteractive();
    this.jumpBtn = this.add.text(700, 520, "‚¨Ü", btnStyle).setInteractive();

    // Variables pour savoir si le bouton est press√©
    this.movingLeft = false;
    this.movingRight = false;

    // √âv√©nements tactiles
    this.leftBtn.on('pointerdown', () => this.movingLeft = true);
    this.leftBtn.on('pointerup', () => this.movingLeft = false);
    this.rightBtn.on('pointerdown', () => this.movingRight = true);
    this.rightBtn.on('pointerup', () => this.movingRight = false);
    this.jumpBtn.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }


update() {
    const p = this.player;

    // D√©placement horizontal
    if (this.cursors.left.isDown || this.movingLeft) p.setVelocityX(-160);
    else if (this.cursors.right.isDown || this.movingRight) p.setVelocityX(160);
    else p.setVelocityX(0);

    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}
}

/* =========================================================
                        LEVEL 4
========================================================= */
class Level4 extends Phaser.Scene {
  constructor() { super("Level4"); }

  create() {
	this.transitioning = false;
    this.platforms = this.physics.add.staticGroup();
    this.spikes = this.physics.add.staticGroup();
    this.redCircles = this.physics.add.group();

    // Plateformes
    createPlatform(this, 0, 480, 120, 120);
    createPlatform(this, 240, 440, 40, 40);
    createPlatform(this, 440, 520, 40, 40);
    createPlatform(this, 680, 480, 120, 40);
    createPlatform(this, 720, 360, 80, 40);
    createPlatform(this, 480, 320, 40, 40);
    createPlatform(this, 440, 200, 40, 160);
    createPlatform(this, 680, 240, 80, 40);
    createPlatform(this, 680, 160, 40, 80);
    createPlatform(this, 720, 0, 80, 80);
    createPlatform(this, 240, 0, 280, 40);
    createPlatform(this, 240, 160, 280, 40);
    createPlatform(this, 0, 200, 280, 40);
    createPlatform(this, 0, 160, 40, 40);
    createPlatform(this, 0, 0, 40, 40);

		//bouton
		const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("World1");
        });

    // Joueur
    const playerSize = 40;
    const playerGfx = this.add.graphics();
    playerGfx.fillStyle(colorPlayer, 1);
    playerGfx.fillRect(0, 0, playerSize, playerSize);
    playerGfx.generateTexture('playerSquare', playerSize, playerSize);
    playerGfx.destroy();

    this.player = this.physics.add.sprite(60, 370, 'playerSquare');
    this.player.setBounce(0.2);
    this.player.setCollideWorldBounds(true);

    // Piques Level 4
    const spikePositions = [
      {x:140, y:600}, {x:180, y:600}, {x:220, y:600}, {x:260, y:600}, {x:300, y:600},
      {x:340, y:600}, {x:380, y:600}, {x:420, y:600}, {x:460, y:600}, {x:500, y:600},
      {x:540, y:600}, {x:580, y:600}, {x:620, y:600}, {x:660, y:600}, {x:700, y:600},
      {x:740, y:600}, {x:780, y:600}, {x:800, y:460, orientation:'left'}, {x:800, y:420, orientation:'left'},
      {x:440, y:260, orientation:'left'}, {x:440, y:300, orientation:'left'}, {x:440, y:340, orientation:'left'},
      {x:720, y:380, orientation:'left'}, {x:680, y:260, orientation:'left'}, {x:680, y:220, orientation:'left'},
      {x:680, y:180, orientation:'left'}, {x:740, y:80, orientation:'down'}, {x:780, y:80, orientation:'down'},
      {x:720, y:60, orientation:'left'}, {x:720, y:20, orientation:'left'}, {x:440, y:220, orientation:'left'},
      {x:520, y:180, orientation:'right'}, {x:520, y:20, orientation:'right'},
      {x:220, y:0, orientation:'down'}, {x:220, y:200}, {x:180, y:200}, {x:140, y:200}, {x:100, y:200}, {x:60, y:200},
      {x:180, y:0, orientation:'down'}, {x:140, y:0, orientation:'down'}, {x:100, y:0, orientation:'down'}, {x:60, y:0, orientation:'down'},
      {x:0, y:60, orientation:'right'}, {x:0, y:100, orientation:'right'}, {x:0, y:140, orientation:'right'}
    ];

    spikePositions.forEach(spike => createRedTriangle(this, spike.x, spike.y, spike.orientation));

    // Boules rouges
    this.redCircles.add(createRedCircle(this, 460, 150));
    this.redCircles.add(createRedCircle(this, 380, 50, 100, 'down'));
    this.redCircles.add(createRedCircle(this, 300, 150));

    // Boule bleue
    this.blueCircle = createBlueCircle(this, 100, 100);

    // Collisions
    this.physics.add.collider(this.player, this.platforms);
    this.physics.add.collider(this.player, this.spikes, (p,s) => onPlayerHitSpike(p,s,this));
    this.physics.add.overlap(this.player, this.redCircles, () => this.scene.restart());
 this.physics.add.overlap(this.player, this.blueCircle, () => {
    if (this.transitioning) return;
    this.transitioning = true;

    this.player.body.enable = false;

    const targetX = this.blueCircle.x;
    const targetY = this.blueCircle.y;

    this.tweens.add({
      targets: this.player,
      x: targetX,
      y: targetY,
      scale: 0.3,
      angle: 720,
      duration: 800,
      ease: 'Cubic.easeInOut',
      onComplete: () => {
		showInterstitial()
		playerCoins += 10;
		localStorage.setItem("playerCoins", playerCoins)
        this.scene.start("World1");
      }
    });
  }, null, this);
 // --- BOUTONS DANS LE CANVAS ---
    const btnStyle = { fontSize: "32px", color: "#ffffff", backgroundColor: "#00BFFF", padding: {x:10, y:5}, borderRadius: 5 };
    this.leftBtn = this.add.text(50, 520, "‚óÄ", btnStyle).setInteractive();
    this.rightBtn = this.add.text(150, 520, "‚ñ∂", btnStyle).setInteractive();
    this.jumpBtn = this.add.text(700, 520, "‚¨Ü", btnStyle).setInteractive();

    // Variables pour savoir si le bouton est press√©
    this.movingLeft = false;
    this.movingRight = false;

    // √âv√©nements tactiles
    this.leftBtn.on('pointerdown', () => this.movingLeft = true);
    this.leftBtn.on('pointerup', () => this.movingLeft = false);
    this.rightBtn.on('pointerdown', () => this.movingRight = true);
    this.rightBtn.on('pointerup', () => this.movingRight = false);
    this.jumpBtn.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }



update() {
    const p = this.player;

    // D√©placement horizontal
    if (this.cursors.left.isDown || this.movingLeft) p.setVelocityX(-160);
    else if (this.cursors.right.isDown || this.movingRight) p.setVelocityX(160);
    else p.setVelocityX(0);

    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}
}


/* =========================================================
                        LEVEL 5
========================================================= */
class Level5 extends Phaser.Scene {
  constructor() { super("Level5"); }

  create() {
	this.transitioning = false;
    this.platforms = this.physics.add.staticGroup();
    this.spikes = this.physics.add.staticGroup();
    this.redCircles = this.physics.add.group();

		//bouton
		const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("World1");
        });

    // Plateformes
    createPlatform(this, 0, 560, 800, 40); // sol
    createPlatform(this, 0, 80, 120, 80);
    createPlatform(this, 0, 160, 80, 400);
    createPlatform(this, 280, 0, 40, 480);
    createPlatform(this, 320, 400, 360, 40);
    createPlatform(this, 720, 520, 80, 40);
    createPlatform(this, 760, 480, 40, 40);
    createPlatform(this, 400, 280, 400, 40);
    createPlatform(this, 680, 120, 120, 40);
    createPlatform(this, 320, 40, 160, 160, 0xAA66CC);
    createPlatform(this, 480, 0, 40, 200);
    createPlatform(this, 320, 160, 160, 40);
    createPlatform(this, 320, 0, 160, 40);

    // Joueur
    const playerSize = 40;
   const playerGfx = this.add.graphics();
playerGfx.fillStyle(colorPlayer, 1);
playerGfx.fillRect(0, 0, playerSize, playerSize);
playerGfx.generateTexture('playerSquare', playerSize, playerSize);
playerGfx.destroy();

this.player = this.physics.add.sprite(60, 0, 'playerSquare');
this.player.setBounce(0.2);
this.player.setCollideWorldBounds(true);
    // Piques Level 5
    const spikePositions = [
      {x:280, y:20, orientation:'left'}, {x:280, y:60, orientation:'left'}, {x:280, y:100, orientation:'left'},
      {x:280, y:140, orientation:'left'}, {x:280, y:180, orientation:'left'}, {x:280, y:220, orientation:'left'},
      {x:280, y:260, orientation:'left'}, {x:280, y:300, orientation:'left'}, {x:280, y:340, orientation:'left'},
      {x:280, y:380, orientation:'left'}, {x:280, y:420, orientation:'left'}, {x:280, y:460, orientation:'left'},
      {x:80, y:180, orientation:'right'}, {x:80, y:220, orientation:'right'}, {x:80, y:260, orientation:'right'},
      {x:80, y:300, orientation:'right'}, {x:80, y:340, orientation:'right'}, {x:80, y:380, orientation:'right'},
      {x:80, y:420, orientation:'right'}, {x:80, y:460, orientation:'right'}, {x:80, y:500, orientation:'right'},
      {x:80, y:540, orientation:'right'}, {x:400, y:560}, {x:440, y:560},
      {x:780, y:320, orientation:'down'}, {x:740, y:320, orientation:'down'}, {x:700, y:320, orientation:'down'},
      {x:660, y:320, orientation:'down'}, {x:620, y:320, orientation:'down'}, {x:580, y:320, orientation:'down'},
      {x:420, y:320, orientation:'down'}, {x:780, y:160, orientation:'down'}, {x:740, y:160, orientation:'down'},
      {x:700, y:160, orientation:'down'}, {x:340, y:200, orientation:'down'}, {x:380, y:200, orientation:'down'},
      {x:420, y:200, orientation:'down'}, {x:460, y:200, orientation:'down'}, {x:500, y:200, orientation:'down'},
      {x:520, y:180, orientation:'right'}, {x:520, y:140, orientation:'right'}, {x:520, y:100, orientation:'right'},
      {x:520, y:60, orientation:'right'}, {x:520, y:20, orientation:'right'}
    ];
    spikePositions.forEach(spike => createRedTriangle(this, spike.x, spike.y, spike.orientation));

    // Boules rouges
    this.redCircles.add(createRedCircle(this, 220, 460, 0));
    this.redCircles.add(createRedCircle(this, 140, 220, 0));
    this.redCircles.add(createRedCircle(this, 560, 550));
    this.redCircles.add(createRedCircle(this, 600, 550));
    this.redCircles.add(createRedCircle(this, 640, 450, 100, 'down'));
    this.redCircles.add(createRedCircle(this, 540, 330, 60, 'down'));
    this.redCircles.add(createRedCircle(this, 470, 390, 60));

    // Boule bleue
    this.blueCircle = createBlueCircle(this, 740, 60);

    // Collisions
    this.physics.add.collider(this.player, this.platforms);
    this.physics.add.collider(this.player, this.spikes, (p,s) => onPlayerHitSpike(p,s,this));
    this.physics.add.overlap(this.player, this.redCircles, () => this.scene.restart());
 	this.physics.add.overlap(this.player, this.blueCircle, () => {
    if (this.transitioning) return;
    this.transitioning = true;

    this.player.body.enable = false;

    const targetX = this.blueCircle.x;
    const targetY = this.blueCircle.y;

    this.tweens.add({
      targets: this.player,
      x: targetX,
      y: targetY,
      scale: 0.3,
      angle: 720,
      duration: 800,
      ease: 'Cubic.easeInOut',
      onComplete: () => {
		showInterstitial()
		playerCoins += 10;
		localStorage.setItem("playerCoins", playerCoins)
        this.scene.start("World1");
      }
    });
  }, null, this);
 // --- BOUTONS DANS LE CANVAS ---
    const btnStyle = { fontSize: "32px", color: "#ffffff", backgroundColor: "#00BFFF", padding: {x:10, y:5}, borderRadius: 5 };
    this.leftBtn = this.add.text(50, 520, "‚óÄ", btnStyle).setInteractive();
    this.rightBtn = this.add.text(150, 520, "‚ñ∂", btnStyle).setInteractive();
    this.jumpBtn = this.add.text(700, 520, "‚¨Ü", btnStyle).setInteractive();

    // Variables pour savoir si le bouton est press√©
    this.movingLeft = false;
    this.movingRight = false;

    // √âv√©nements tactiles
    this.leftBtn.on('pointerdown', () => this.movingLeft = true);
    this.leftBtn.on('pointerup', () => this.movingLeft = false);
    this.rightBtn.on('pointerdown', () => this.movingRight = true);
    this.rightBtn.on('pointerup', () => this.movingRight = false);
    this.jumpBtn.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }



update() {
    const p = this.player;

    // D√©placement horizontal
    if (this.cursors.left.isDown || this.movingLeft) p.setVelocityX(-160);
    else if (this.cursors.right.isDown || this.movingRight) p.setVelocityX(160);
    else p.setVelocityX(0);

    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}
}
/* =========================================================
                        SHOP SCENE
========================================================= */
class ShopScene extends Phaser.Scene {
    constructor() {
        super("ShopScene");
    }

    create() {

        // Titre
        this.add.text(400, 50, "Boutique", {
            fontSize: "48px",
            color: "#ffffff"
        }).setOrigin(0.5);

        // Items √† acheter (exemple)
        const items = [
            { name: "Couleur Joueur Violet", key: "0xAA66CC", price: 0 },
            { name: "Couleur Joueur Vert", key: "#73BE73", price: 150 },
			{ name: "Couleur Joueur Rose", key: "#CC99A2", price: 200 },
			{ name: "Couleur Joueur Noir", key: "#000000", price: 250 },
			{ name: "Couleur Joueur Orange", key: "#FFA500", price: 300 },
			{ name: "Couleur Joueur Turquoise", key: "#40E0D0", price: 350 }
        ];

        let yPos = 150;
        items.forEach(item => {
            const itemText = this.add.text(400, yPos, `${item.name} - ${item.price} pi√®ces`, {
                fontSize: "28px",
                color: "#ffffff",
                backgroundColor: "#00BFFF",
                padding: { x: 10, y: 5 },
                borderRadius: 5
            }).setOrigin(0.5).setInteractive();
 itemText.on("pointerdown", () => {
                    // Appliquer la couleur du joueur
                    colorPlayer = typeof item.key === 'string' && item.key.startsWith('#') 
                                  ? parseInt(item.key.replace('#',''), 16) 
                                  : parseInt(item.key);
                    localStorage.setItem("colorPlayer", colorPlayer);
                    this.scene.start("ShowPlayer");
            });

            yPos += 70;
        });

        // Bouton retour
        const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("MenuScene");
        });
    }
}
/* =========================================================
                        LEVEL 6
========================================================= */
class Level6 extends Phaser.Scene {
  constructor() { super("Level6"); }

  create() {
	this.transitioning = false;
    this.platforms = this.physics.add.staticGroup();
    this.spikes = this.physics.add.staticGroup();
    this.redCircles = this.physics.add.group();

		//bouton
		const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("World1");
        });

    // Plateformes
  createPlatform(this, 0, 560, 800, 40); //sol
  createPlatform(this, 0, 520, 40, 40);
  createPlatform(this, 240, 520, 40, 40);
  createPlatform(this, 0, 280, 360, 40);
  createPlatform(this, 240, 320, 40, 80);
  createPlatform(this, 320, 320, 40, 80);
  createPlatform(this, 320, 520, 40, 40);
  createPlatform(this, 280, 320, 40, 40);
  createPlatform(this, 360, 280, 160, 80);
  createPlatform(this, 480, 520, 40, 40);
  createPlatform(this, 480, 360, 40, 40);
  createPlatform(this, 640, 480, 40, 80);
  createPlatform(this, 760, 360, 40, 40);
  createPlatform(this, 760, 280, 40, 40);
  createPlatform(this, 80, 80, 720, 40);
  createPlatform(this, 0, 160, 40, 40);

    // Joueur
    const playerSize = 40;
   const playerGfx = this.add.graphics();
playerGfx.fillStyle(colorPlayer, 1);
playerGfx.fillRect(0, 0, playerSize, playerSize);
playerGfx.generateTexture('playerSquare', playerSize, playerSize);
playerGfx.destroy();

this.player = this.physics.add.sprite(0, 440, 'playerSquare');
this.player.setBounce(0.2);
this.player.setCollideWorldBounds(true);
    // Piques Level 6
  createRedTriangle(this, 20, 320, 'down');
  createRedTriangle(this, 60, 320, 'down');
  createRedTriangle(this, 100, 320, 'down');
  createRedTriangle(this, 140, 320, 'down');
  createRedTriangle(this, 180, 320, 'down');
  createRedTriangle(this, 220, 320, 'down');
  createRedTriangle(this, 340, 400, 'down');
  createRedTriangle(this, 260, 400, 'down');
  createRedTriangle(this, 380, 560);
  createRedTriangle(this, 420, 560);
  createRedTriangle(this, 460, 560);
  createRedTriangle(this, 500, 400, 'down');
  createRedTriangle(this, 380, 360, 'down');
  createRedTriangle(this, 420, 360, 'down');
  createRedTriangle(this, 460, 360, 'down');
  createRedTriangle(this, 540, 560);
  createRedTriangle(this, 580, 560);
  createRedTriangle(this, 620, 560);
  createRedTriangle(this, 700, 560);
  createRedTriangle(this, 740, 560);
  createRedTriangle(this, 780, 560);
  createRedTriangle(this, 780, 400, 'down');
  createRedTriangle(this, 800, 260, 'left');
  createRedTriangle(this, 800, 220, 'left');
  createRedTriangle(this, 800, 180, 'left');
  createRedTriangle(this, 800, 140, 'left');
  createRedTriangle(this, 220, 280);
  createRedTriangle(this, 180, 280);
  createRedTriangle(this, 0, 260, 'right');
  createRedTriangle(this, 0, 220, 'right');
  createRedTriangle(this, 220, 120, 'down');
  createRedTriangle(this, 180, 120, 'down');
    // Boules rouges
this.redCircles.add(createRedCircle(this, 300, 370, 180, 'down'));
this.redCircles.add(createRedCircle(this, 180, 10, 60, 'down'));
this.redCircles.add(createRedCircle(this, 260, 70, 60));
this.redCircles.add(createRedCircle(this, 340, 10, 60, 'down'));
this.redCircles.add(createRedCircle(this, 420, 70, 60));
this.redCircles.add(createRedCircle(this, 500, 10, 60, 'down'));
this.redCircles.add(createRedCircle(this, 580, 70, 60));

//carr√©s rouges
  this.redSquares = this.physics.add.group();
  this.physics.add.collider(this.redSquares, this.platforms);
  this.redSquares.add(createRedSquare(60, 540, this, 160, 'right'));
  this.redSquares.add(createRedSquare(220, 540, this, 160, 'left'));
  this.redSquares.add(createRedSquare(500, 260, this, 240, 'left'));
  this.redSquares.add(createRedSquare(260, 260, this, 240, 'right'));
    // Boule bleue
    this.blueCircle = createBlueCircle(this, 770, 30);

    // Collisions
    this.physics.add.collider(this.player, this.platforms);
    this.physics.add.collider(this.player, this.spikes, (p,s) => onPlayerHitSpike(p,s,this));
    this.physics.add.overlap(this.player, this.redCircles, () => this.scene.restart());
 	this.physics.add.overlap(this.player, this.blueCircle, () => {
    if (this.transitioning) return;
    this.transitioning = true;

    this.player.body.enable = false;

    const targetX = this.blueCircle.x;
    const targetY = this.blueCircle.y;

    this.tweens.add({
      targets: this.player,
      x: targetX,
      y: targetY,
      scale: 0.3,
      angle: 720,
      duration: 800,
      ease: 'Cubic.easeInOut',
      onComplete: () => {
		showInterstitial()
		playerCoins += 10;
		localStorage.setItem("playerCoins", playerCoins)
        this.scene.start("World1");
      }
    });
  }, null, this);
	   this.physics.add.overlap(this.player, this.redSquares, (player, square) => {
  const playerBottom = player.y + player.displayHeight / 2;
  const squareTop = square.y - square.displayHeight / 2;
		   
  const verticalDiff = playerBottom - squareTop;

  // Si le joueur touche par le haut (avec une petite marge de tol√©rance)
  if (verticalDiff < 10 && player.body.velocity.y > 0) {
    // Le joueur a saut√© sur le carr√© rouge
    player.setVelocityY(-200);
    this.tweens.add({
      targets: square,
      scaleX: 0,
      scaleY: 0,
      duration: 300,
      ease: 'Cubic.easeIn',
      onComplete: () => {
        square.destroy();
      }
    });
    } else {
    // Collision par c√¥t√© ou par dessous : mort
    this.scene.restart();
  }
  }, null, this);
 // --- BOUTONS DANS LE CANVAS ---
    const btnStyle = { fontSize: "32px", color: "#ffffff", backgroundColor: "#00BFFF", padding: {x:10, y:5}, borderRadius: 5 };
    this.leftBtn = this.add.text(50, 520, "‚óÄ", btnStyle).setInteractive();
    this.rightBtn = this.add.text(150, 520, "‚ñ∂", btnStyle).setInteractive();
    this.jumpBtn = this.add.text(700, 520, "‚¨Ü", btnStyle).setInteractive();

    // Variables pour savoir si le bouton est press√©
    this.movingLeft = false;
    this.movingRight = false;

    // √âv√©nements tactiles
    this.leftBtn.on('pointerdown', () => this.movingLeft = true);
    this.leftBtn.on('pointerup', () => this.movingLeft = false);
    this.rightBtn.on('pointerdown', () => this.movingRight = true);
    this.rightBtn.on('pointerup', () => this.movingRight = false);
    this.jumpBtn.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }



update() {
    const p = this.player;

    // D√©placement horizontal
    if (this.cursors.left.isDown || this.movingLeft) p.setVelocityX(-160);
    else if (this.cursors.right.isDown || this.movingRight) p.setVelocityX(160);
    else p.setVelocityX(0);

    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}
}
/* =========================================================
                        SHOW PLAYER
========================================================= */
class ShowPlayer extends Phaser.Scene {
    constructor() {
        super("ShowPlayer");
    }

    create() {
		this.platforms = this.physics.add.staticGroup();
		createPlatform(this, 320, 280, 160);
		const size = 40;
        const g = this.add.graphics();
        g.fillStyle(colorPlayer, 1);
        g.fillRect(0, 0, size, size);
        g.generateTexture("player", size, size);
        g.destroy();

        this.player = this.physics.add.sprite(400, 100, "player");
        this.player.setBounce(0.2).setCollideWorldBounds(true);
		this.physics.add.collider(this.player, this.platforms);
        // Bouton retour
        const backButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        backButton.on("pointerdown", () => {
            this.scene.start("MenuScene");
        });
	this.input.on('pointerdown', () => this.jumpPlayer());
        this.cursors = this.input.keyboard.createCursorKeys();
        this.jumpCount = 0;
    }
	update() {
    const p = this.player;
    // Reset compteur saut
    if (p.body.touching.down) this.jumpCount = 0;

    // Saut via clavier
    if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) this.jumpPlayer();
}

// --- fonction saut + double saut ---
jumpPlayer() {
    if (this.jumpCount < 2) {
        this.player.setVelocityY(-330);

        if (this.jumpCount === 1) {
            let dir = this.cursors.left.isDown ? -1 : (this.cursors.right.isDown ? 1 : 1);
            this.tweens.add({ targets: this.player, angle: this.player.angle + 180 * dir, duration: 500, ease: "Cubic.easeOut" });
        }

        this.jumpCount++;
    }
}
}
/* =========================================================
                       World 1
========================================================= */

class World1 extends Phaser.Scene {
    constructor() {
        super("World1");
    }

    create() {
		
        const title = this.add.text(400, 80, "World 1", {
            fontSize: "50px",
            color: "#ffffffff"
        }).setOrigin(0.5);
		this.coinText = this.add.text(780, 20, `üí∞ ${playerCoins}`, {
    		fontSize: "28px",
    		color: "#ffff00"
		}).setOrigin(1, 0); // align√© √† droite
		const MenuButton = this.add.text(5, 5, "‚Üê", {
            fontSize: "24px",
            color: "#ffffff",
            backgroundColor: "#00BFFF",
            padding: { x: 7, y: 4 },
            borderRadius: 5
        }).setInteractive();

        MenuButton.on("pointerdown", () => {
            this.scene.start("MenuScene");
        });
        const niveaux1 = [
            { nom: "‚û° Level 1", scene: "Level1" },
            { nom: "‚û° Level 2", scene: "Level2" },
            { nom: "‚û° Level 3", scene: "Level3" },
            { nom: "‚û° Level 4", scene: "Level4" }
        ];

        let yPos1 = 260;
        niveaux1.forEach(niv => {
            const btn = this.add.text(200, yPos1, niv.nom, {
                fontSize: "34px",
                color: "#ffffffff"
            }).setOrigin(0.5).setInteractive();

            btn.on("pointerdown", () => this.scene.start(niv.scene));

            yPos1 += 60; // √©cart vertical entre boutons
        });
		        const niveaux2 = [
            { nom: "‚û° Level 5", scene: "Level5" },
			{ nom: "‚û° Level 6", scene: "Level6" }
        ];

        let yPos2 = 260;
        niveaux2.forEach(niv => {
            const btn = this.add.text(500, yPos2, niv.nom, {
                fontSize: "34px",
                color: "#ffffffff"
            }).setOrigin(0.5).setInteractive();

            btn.on("pointerdown", () => this.scene.start(niv.scene));

            yPos2 += 60; // √©cart vertical entre boutons
        });
    }
}
/* =========================================================
                    CONFIG JEU
========================================================= */
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  backgroundColor: '#ADD8E6',
  physics: { default: 'arcade', arcade: { gravity: { y: 650 }, debug: false } },
   scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
   },
  scene: [MenuScene, Level1, Level2, Level3, Level4, Level5, ShopScene, Level6, ShowPlayer, World1]
};

const game = new Phaser.Game(config);
		</script>
    </body>
</html>




















